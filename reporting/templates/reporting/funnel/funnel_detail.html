{% extends "reporting/base.html" %}
{% load humanize %}

{% block title %}{{ department.company.name }} - {{ department.name }} | 펀넬 상세{% endblock %}

{% block content %}
<div class="container-fluid" style="padding: 2rem; max-width: 1600px; margin: 0 auto;">

  <!-- 뒤로가기 + 헤더 -->
  <div class="mb-4">
    <a href="{% url 'reporting:funnel_list' %}" style="color: var(--text-muted); text-decoration: none; font-size: 0.85rem;">
      <i class="fas fa-arrow-left"></i> 펀넬 목록으로
    </a>
    <h2 style="font-weight: 700; margin: 0.5rem 0 0 0;">
      <span style="color: var(--text-secondary); font-size: 0.9rem;">{{ department.company.name }}</span>
      <br>{{ department.name }}
    </h2>
    <p style="color: var(--text-secondary); margin: 0.25rem 0 0 0; font-size: 0.85rem;">
      {{ last_year }}년 vs {{ current_year }}년 비교 분석
      {% if dept_followups %}· 고객 {{ dept_followups.count }}명{% endif %}
    </p>
  </div>

  <!-- 핵심 지표 카드 -->
  <div class="row g-3 mb-4">
    <div class="col-lg-2 col-md-4 col-6">
      <div class="metric-card">
        <div class="metric-label">{{ last_year }}년 매출</div>
        <div class="metric-value">{{ last_revenue|floatformat:0|intcomma }}<span class="metric-unit">원</span></div>
      </div>
    </div>
    <div class="col-lg-2 col-md-4 col-6">
      <div class="metric-card">
        <div class="metric-label">{{ current_year }}년 목표</div>
        <div class="metric-value" style="color: var(--primary-light);">{{ target_revenue|floatformat:0|intcomma }}<span class="metric-unit">원</span></div>
      </div>
    </div>
    <div class="col-lg-2 col-md-4 col-6">
      <div class="metric-card">
        <div class="metric-label">{{ current_year }}년 실제</div>
        <div class="metric-value" style="color: var(--success);">{{ current_revenue|floatformat:0|intcomma }}<span class="metric-unit">원</span></div>
      </div>
    </div>
    <div class="col-lg-2 col-md-4 col-6">
      <div class="metric-card">
        <div class="metric-label">달성률</div>
        <div class="metric-value {% if achievement_rate >= 80 %}text-success{% elif achievement_rate >= 50 %}text-warning{% else %}text-danger{% endif %}">
          {{ achievement_rate }}<span class="metric-unit">%</span>
        </div>
      </div>
    </div>
    <div class="col-lg-2 col-md-4 col-6">
      <div class="metric-card">
        <div class="metric-label">전년 대비</div>
        <div class="metric-value {% if growth_rate >= 0 %}text-success{% else %}text-danger{% endif %}">
          {% if growth_rate >= 0 %}+{% endif %}{{ growth_rate }}<span class="metric-unit">%</span>
        </div>
      </div>
    </div>
    <div class="col-lg-2 col-md-4 col-6">
      <div class="metric-card">
        <div class="metric-label">목표 잔여</div>
        <div class="metric-value" style="font-size: 1rem;">
          {% if target_achieved %}
            <span style="color: var(--success);">달성 완료!</span>
          {% elif target_revenue > 0 %}
            <span style="color: var(--warning);">{{ remaining_revenue|floatformat:0|intcomma }}원</span>
          {% else %}
            <span style="color: var(--text-muted);">목표 미설정</span>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <!-- 활동 비교 카드 -->
  <div class="row g-3 mb-4">
    <div class="col-md-4">
      <div class="compare-card">
        <div class="compare-title"><i class="fas fa-users"></i> 미팅</div>
        <div class="compare-row">
          <span>{{ last_year }}년</span>
          <span class="compare-val">{{ last_stats.meeting_count }}회</span>
        </div>
        <div class="compare-row">
          <span>{{ current_year }}년</span>
          <span class="compare-val" style="color: var(--primary-light);">{{ current_stats.meeting_count }}회</span>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="compare-card">
        <div class="compare-title"><i class="fas fa-file-invoice"></i> 견적</div>
        <div class="compare-row">
          <span>{{ last_year }}년</span>
          <span class="compare-val">{{ last_stats.quote_count }}건</span>
        </div>
        <div class="compare-row">
          <span>{{ current_year }}년</span>
          <span class="compare-val" style="color: var(--primary-light);">{{ current_stats.quote_count }}건</span>
        </div>
      </div>
    </div>
    <div class="col-md-4">
      <div class="compare-card">
        <div class="compare-title"><i class="fas fa-truck"></i> 납품</div>
        <div class="compare-row">
          <span>{{ last_year }}년</span>
          <span class="compare-val">{{ last_stats.delivery_count }}건</span>
        </div>
        <div class="compare-row">
          <span>{{ current_year }}년</span>
          <span class="compare-val" style="color: var(--success);">{{ current_stats.delivery_count }}건</span>
        </div>
      </div>
    </div>
  </div>

  <!-- 월별 매출 추이 차트 -->
  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="detail-card">
        <h5 class="detail-card-title"><i class="fas fa-chart-line"></i> 월별 매출 추이</h5>
        <div style="position: relative; height: 300px;">
          <canvas id="monthlyRevenueChart"></canvas>
        </div>
      </div>
    </div>
  </div>

  <!-- 다음 예정 일정 -->
  {% if upcoming_schedules %}
  <div class="row g-3 mb-4">
    <div class="col-12">
      <div class="detail-card">
        <h5 class="detail-card-title"><i class="fas fa-calendar-alt"></i> 다음 예정 일정</h5>
        <div class="upcoming-list">
          {% for sch in upcoming_schedules %}
          <div class="upcoming-item">
            <div class="upcoming-date">
              <span class="upcoming-month">{{ sch.visit_date|date:"m월" }}</span>
              <span class="upcoming-day">{{ sch.visit_date|date:"d" }}</span>
            </div>
            <div class="upcoming-info">
              <span class="upcoming-type type-{{ sch.activity_type }}">
                {% if sch.activity_type == 'customer_meeting' %}미팅{% elif sch.activity_type == 'quote' %}견적{% elif sch.activity_type == 'delivery' %}납품{% else %}서비스{% endif %}
              </span>
              <span>{{ sch.followup.customer_name }}</span>
              {% if sch.visit_time %}<span style="color: var(--text-muted); font-size: 0.8rem;">{{ sch.visit_time|time:"H:i" }}</span>{% endif %}
            </div>
            {% if sch.expected_revenue %}
            <div class="upcoming-amount">{{ sch.expected_revenue|floatformat:0|intcomma }}원</div>
            {% endif %}
          </div>
          {% endfor %}
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- 탭: 납품/견적/제품 비교 -->
  <div class="detail-card mb-4">
    <ul class="nav nav-tabs detail-tabs" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-deliveries" type="button">
          <i class="fas fa-truck"></i> 납품 내역
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-quotes" type="button">
          <i class="fas fa-file-invoice"></i> 견적 내역
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-products" type="button">
          <i class="fas fa-box"></i> 제품별 분석
        </button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-meetings" type="button">
          <i class="fas fa-users"></i> 미팅 이력
        </button>
      </li>
    </ul>
    
    <div class="tab-content" style="padding: 1.25rem;">
      
      <!-- 납품 내역 탭 -->
      <div class="tab-pane fade show active" id="tab-deliveries">
        <div class="row g-4">
          <!-- 작년 납품 -->
          <div class="col-lg-6">
            <h6 style="color: var(--text-secondary); margin-bottom: 1rem;">{{ last_year }}년 납품 ({{ last_deliveries.count }}건)</h6>
            {% for schedule in last_deliveries %}
            <div class="history-item">
              <div class="history-date">{{ schedule.visit_date|date:"m/d" }}</div>
              <div class="history-detail">
                <span style="font-weight: 600;">{{ schedule.followup.customer_name }}</span>
                {% for item in schedule.delivery_items_set.all %}
                <div style="font-size: 0.8rem; color: var(--text-muted);">{{ item.item_name }} × {{ item.quantity }} = {{ item.total_price|floatformat:0|intcomma }}원</div>
                {% endfor %}
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">납품 내역 없음</p>
            {% endfor %}
          </div>
          <!-- 올해 납품 -->
          <div class="col-lg-6">
            <h6 style="color: var(--primary-light); margin-bottom: 1rem;">{{ current_year }}년 납품 ({{ current_deliveries.count }}건)</h6>
            {% for schedule in current_deliveries %}
            <div class="history-item">
              <div class="history-date">{{ schedule.visit_date|date:"m/d" }}</div>
              <div class="history-detail">
                <span style="font-weight: 600;">{{ schedule.followup.customer_name }}</span>
                {% for item in schedule.delivery_items_set.all %}
                <div style="font-size: 0.8rem; color: var(--text-muted);">{{ item.item_name }} × {{ item.quantity }} = {{ item.total_price|floatformat:0|intcomma }}원</div>
                {% endfor %}
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">납품 내역 없음</p>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- 견적 내역 탭 -->
      <div class="tab-pane fade" id="tab-quotes">
        <div class="row g-4">
          <div class="col-lg-6">
            <h6 style="color: var(--text-secondary); margin-bottom: 1rem;">{{ last_year }}년 견적 ({{ last_quotes.count }}건)</h6>
            {% for schedule in last_quotes %}
            <div class="history-item">
              <div class="history-date">{{ schedule.visit_date|date:"m/d" }}</div>
              <div class="history-detail">
                <span style="font-weight: 600;">{{ schedule.followup.customer_name }}</span>
                {% if schedule.expected_revenue %}
                <div style="font-size: 0.8rem; color: var(--text-muted);">예상: {{ schedule.expected_revenue|floatformat:0|intcomma }}원</div>
                {% endif %}
              </div>
              <div>
                <span class="status-badge status-{{ schedule.status }}">{{ schedule.get_status_display }}</span>
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">견적 내역 없음</p>
            {% endfor %}
          </div>
          <div class="col-lg-6">
            <h6 style="color: var(--primary-light); margin-bottom: 1rem;">{{ current_year }}년 견적 ({{ current_quotes.count }}건)</h6>
            {% for schedule in current_quotes %}
            <div class="history-item">
              <div class="history-date">{{ schedule.visit_date|date:"m/d" }}</div>
              <div class="history-detail">
                <span style="font-weight: 600;">{{ schedule.followup.customer_name }}</span>
                {% if schedule.expected_revenue %}
                <div style="font-size: 0.8rem; color: var(--text-muted);">예상: {{ schedule.expected_revenue|floatformat:0|intcomma }}원</div>
                {% endif %}
              </div>
              <div>
                <span class="status-badge status-{{ schedule.status }}">{{ schedule.get_status_display }}</span>
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">견적 내역 없음</p>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- 제품별 분석 탭 -->
      <div class="tab-pane fade" id="tab-products">
        <div class="row g-4">
          <div class="col-lg-6">
            <h6 style="color: var(--text-secondary); margin-bottom: 1rem;">{{ last_year }}년 제품별 매출 TOP 10</h6>
            {% for prod in last_product_sales %}
            <div class="product-item">
              <div>
                <span style="font-weight: 600;">{{ prod.item_name }}</span>
                <span style="font-size: 0.8rem; color: var(--text-muted);">({{ prod.qty }}개)</span>
              </div>
              <div style="font-weight: 600; font-variant-numeric: tabular-nums;">
                {{ prod.total|floatformat:0|intcomma }}원
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">제품 데이터 없음</p>
            {% endfor %}
          </div>
          <div class="col-lg-6">
            <h6 style="color: var(--primary-light); margin-bottom: 1rem;">{{ current_year }}년 제품별 매출 TOP 10</h6>
            {% for prod in current_product_sales %}
            <div class="product-item">
              <div>
                <span style="font-weight: 600;">{{ prod.item_name }}</span>
                <span style="font-size: 0.8rem; color: var(--text-muted);">({{ prod.qty }}개)</span>
              </div>
              <div style="font-weight: 600; font-variant-numeric: tabular-nums; color: var(--success);">
                {{ prod.total|floatformat:0|intcomma }}원
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">제품 데이터 없음</p>
            {% endfor %}
          </div>
        </div>
      </div>

      <!-- 미팅 이력 탭 -->
      <div class="tab-pane fade" id="tab-meetings">
        <div class="row g-4">
          <div class="col-lg-6">
            <h6 style="color: var(--text-secondary); margin-bottom: 1rem;">{{ last_year }}년 미팅 ({{ last_meetings.count }}건)</h6>
            {% for sch in last_meetings %}
            <div class="history-item">
              <div class="history-date">{{ sch.visit_date|date:"m/d" }}</div>
              <div class="history-detail">
                <span style="font-weight: 600;">{{ sch.followup.customer_name }}</span>
                {% if sch.visit_time %}<span style="font-size: 0.8rem; color: var(--text-muted);">{{ sch.visit_time|time:"H:i" }}</span>{% endif %}
              </div>
              <div>
                <span class="status-badge status-{{ sch.status }}">{{ sch.get_status_display }}</span>
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">미팅 이력 없음</p>
            {% endfor %}
          </div>
          <div class="col-lg-6">
            <h6 style="color: var(--primary-light); margin-bottom: 1rem;">{{ current_year }}년 미팅 ({{ current_meetings.count }}건)</h6>
            {% for sch in current_meetings %}
            <div class="history-item">
              <div class="history-date">{{ sch.visit_date|date:"m/d" }}</div>
              <div class="history-detail">
                <span style="font-weight: 600;">{{ sch.followup.customer_name }}</span>
                {% if sch.visit_time %}<span style="font-size: 0.8rem; color: var(--text-muted);">{{ sch.visit_time|time:"H:i" }}</span>{% endif %}
              </div>
              <div>
                <span class="status-badge status-{{ sch.status }}">{{ sch.get_status_display }}</span>
              </div>
            </div>
            {% empty %}
            <p style="color: var(--text-muted); font-size: 0.85rem;">미팅 이력 없음</p>
            {% endfor %}
          </div>
        </div>
      </div>

    </div>
  </div>

  <!-- 고객 목록 -->
  {% if dept_followups %}
  <div class="detail-card mb-4">
    <h5 class="detail-card-title"><i class="fas fa-address-book"></i> 고객 목록</h5>
    <div style="padding: 0 1.25rem 1.25rem;">
      <div class="row g-2">
        {% for fu in dept_followups %}
        <div class="col-md-4 col-6">
          <a href="{% url 'reporting:customer_detail_report' fu.id %}" class="customer-card-link">
            <div class="customer-mini-card">
              <div style="font-weight: 600;">{{ fu.customer_name }}</div>
              <div style="font-size: 0.8rem; color: var(--text-muted);">{{ fu.manager_name|default:"-" }}</div>
              {% if fu.ai_grade %}
              <span class="grade-badge grade-{{ fu.ai_grade }}">{{ fu.ai_grade }}</span>
              {% endif %}
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
    </div>
  </div>
  {% endif %}

</div>

<style>
/* 지표 카드 */
.metric-card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 1rem;
  text-align: center;
}
.metric-label {
  font-size: 0.75rem;
  color: var(--text-muted);
  margin-bottom: 0.5rem;
}
.metric-value {
  font-size: 1.25rem;
  font-weight: 700;
  font-variant-numeric: tabular-nums;
}
.metric-unit {
  font-size: 0.75rem;
  font-weight: 400;
  color: var(--text-muted);
  margin-left: 2px;
}

/* 비교 카드 */
.compare-card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  padding: 1rem;
}
.compare-title {
  font-weight: 600;
  margin-bottom: 0.75rem;
  font-size: 0.9rem;
}
.compare-title i {
  color: var(--primary);
  margin-right: 0.25rem;
}
.compare-row {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.25rem 0;
  font-size: 0.85rem;
  color: var(--text-secondary);
}
.compare-val {
  font-weight: 600;
  font-variant-numeric: tabular-nums;
}

/* 상세 카드 */
.detail-card {
  background: var(--card);
  border: 1px solid var(--card-border);
  border-radius: var(--radius);
  overflow: hidden;
}
.detail-card-title {
  font-size: 1rem;
  font-weight: 600;
  padding: 1rem 1.25rem;
  margin: 0;
  border-bottom: 1px solid var(--border-light);
}
.detail-card-title i {
  color: var(--primary);
  margin-right: 0.25rem;
}

/* 탭 */
.detail-tabs {
  border-bottom: 1px solid var(--border);
  padding: 0 1rem;
}
.detail-tabs .nav-link {
  background: none;
  border: none;
  border-bottom: 2px solid transparent;
  color: var(--text-muted);
  padding: 0.75rem 1rem;
  font-size: 0.85rem;
  cursor: pointer;
  transition: all 0.2s;
}
.detail-tabs .nav-link:hover {
  color: var(--text-primary);
}
.detail-tabs .nav-link.active {
  color: var(--primary-light);
  border-bottom-color: var(--primary);
}

/* 히스토리 아이템 */
.history-item {
  display: flex;
  align-items: flex-start;
  gap: 0.75rem;
  padding: 0.6rem 0;
  border-bottom: 1px solid var(--border-light);
  font-size: 0.85rem;
}
.history-date {
  color: var(--text-muted);
  font-size: 0.8rem;
  min-width: 40px;
  font-variant-numeric: tabular-nums;
}
.history-detail {
  flex: 1;
}

/* 상태 뱃지 */
.status-badge {
  font-size: 0.7rem;
  padding: 0.15rem 0.5rem;
  border-radius: 20px;
  white-space: nowrap;
}
.status-scheduled { background: hsla(217, 91%, 60%, 0.2); color: var(--primary-light); }
.status-completed { background: hsla(142, 76%, 36%, 0.2); color: hsl(142, 76%, 50%); }
.status-cancelled { background: hsla(0, 84%, 60%, 0.2); color: hsl(0, 84%, 70%); }

/* 제품 아이템 */
.product-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 0.5rem 0;
  border-bottom: 1px solid var(--border-light);
  font-size: 0.85rem;
}

/* 예정 일정 */
.upcoming-list {
  padding: 0 1.25rem 1rem;
}
.upcoming-item {
  display: flex;
  align-items: center;
  gap: 1rem;
  padding: 0.6rem 0;
  border-bottom: 1px solid var(--border-light);
}
.upcoming-date {
  text-align: center;
  min-width: 48px;
}
.upcoming-month {
  display: block;
  font-size: 0.7rem;
  color: var(--text-muted);
}
.upcoming-day {
  display: block;
  font-size: 1.25rem;
  font-weight: 700;
}
.upcoming-info {
  flex: 1;
  display: flex;
  align-items: center;
  gap: 0.5rem;
  font-size: 0.85rem;
}
.upcoming-type {
  font-size: 0.7rem;
  padding: 0.1rem 0.4rem;
  border-radius: 4px;
  font-weight: 600;
}
.type-customer_meeting { background: hsla(199, 89%, 48%, 0.2); color: var(--info); }
.type-quote { background: hsla(38, 92%, 50%, 0.2); color: var(--warning); }
.type-delivery { background: hsla(142, 76%, 36%, 0.2); color: hsl(142, 76%, 50%); }
.type-service { background: hsla(280, 65%, 60%, 0.2); color: hsl(280, 65%, 70%); }
.upcoming-amount {
  font-weight: 600;
  font-variant-numeric: tabular-nums;
  font-size: 0.85rem;
  color: var(--text-secondary);
}

/* 고객 카드 */
.customer-card-link {
  text-decoration: none;
  color: inherit;
}
.customer-mini-card {
  background: var(--surface-hover);
  border: 1px solid var(--border-light);
  border-radius: var(--radius-sm);
  padding: 0.75rem;
  transition: all 0.2s;
  position: relative;
}
.customer-mini-card:hover {
  border-color: var(--primary);
  box-shadow: 0 0 0 1px var(--primary-bg);
}
.grade-badge {
  position: absolute;
  top: 0.5rem;
  right: 0.5rem;
  font-size: 0.65rem;
  padding: 0.1rem 0.35rem;
  border-radius: 4px;
  font-weight: 700;
}
.grade-VIP { background: linear-gradient(135deg, #ffd700, #ff8c00); color: #000; }
.grade-A { background: hsla(217, 91%, 60%, 0.3); color: var(--primary-light); }
.grade-B { background: hsla(142, 76%, 36%, 0.3); color: hsl(142, 76%, 50%); }
.grade-C { background: hsla(38, 92%, 50%, 0.3); color: var(--warning); }
.grade-D { background: hsla(0, 0%, 50%, 0.3); color: var(--text-muted); }

@media (max-width: 768px) {
  .metric-value { font-size: 1rem; }
  .metric-card { padding: 0.75rem 0.5rem; }
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // 월별 매출 추이 차트
  const ctx = document.getElementById('monthlyRevenueChart');
  if (!ctx) return;
  
  const lastMonthly = {{ last_monthly|safe }};
  const currentMonthly = {{ current_monthly|safe }};
  
  new Chart(ctx.getContext('2d'), {
    type: 'line',
    data: {
      labels: ['1월','2월','3월','4월','5월','6월','7월','8월','9월','10월','11월','12월'],
      datasets: [
        {
          label: '{{ last_year }}년',
          data: lastMonthly,
          borderColor: 'hsl(215, 20%, 65%)',
          backgroundColor: 'hsla(215, 20%, 65%, 0.1)',
          borderWidth: 2,
          borderDash: [5, 5],
          pointRadius: 3,
          pointHoverRadius: 5,
          tension: 0.3,
          fill: true,
        },
        {
          label: '{{ current_year }}년',
          data: currentMonthly,
          borderColor: 'hsl(217, 91%, 60%)',
          backgroundColor: 'hsla(217, 91%, 60%, 0.1)',
          borderWidth: 2,
          pointRadius: 4,
          pointHoverRadius: 6,
          tension: 0.3,
          fill: true,
        }
      ]
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        intersect: false,
        mode: 'index',
      },
      plugins: {
        legend: {
          labels: {
            color: 'hsl(215, 20%, 75%)',
            font: { family: 'Inter', size: 12 },
          }
        },
        tooltip: {
          backgroundColor: 'hsl(222, 47%, 14%)',
          titleColor: 'hsl(210, 40%, 98%)',
          bodyColor: 'hsl(215, 20%, 75%)',
          borderColor: 'hsl(217, 33%, 22%)',
          borderWidth: 1,
          callbacks: {
            label: function(ctx) {
              return ctx.dataset.label + ': ' + Math.round(ctx.parsed.y).toLocaleString('ko-KR') + '원';
            }
          }
        }
      },
      scales: {
        x: {
          grid: { color: 'hsl(217, 33%, 17%)', drawBorder: false },
          ticks: { color: 'hsl(215, 20%, 65%)', font: { size: 11 } },
        },
        y: {
          grid: { color: 'hsl(217, 33%, 17%)', drawBorder: false },
          ticks: {
            color: 'hsl(215, 20%, 65%)',
            font: { size: 11 },
            callback: function(val) {
              if (val >= 10000000) return (val / 10000000).toFixed(1) + '천만';
              if (val >= 10000) return (val / 10000).toFixed(0) + '만';
              return val.toLocaleString();
            }
          },
          beginAtZero: true,
        }
      }
    }
  });
});
</script>
{% endblock %}
